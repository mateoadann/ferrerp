{% extends 'base.html' %}

{% block title %}Productos con Stock Bajo - {{ app_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-1">
                <li class="breadcrumb-item"><a href="{{ url_for('inventario.index') }}">Inventario</a></li>
                <li class="breadcrumb-item active">Stock Bajo</li>
            </ol>
        </nav>
        <h2>Productos con Stock Bajo</h2>
    </div>
</div>

<div class="alert alert-warning mb-4">
    <span class="material-symbols-rounded me-2">warning</span>
    <strong>{{ productos.total }} producto(s)</strong> requieren reposicion de stock.
</div>

<div class="card">
    <div class="table-responsive">
        <table class="table mb-0">
            <thead>
                <tr>
                    <th>Codigo</th>
                    <th>Producto</th>
                    <th>Categoria</th>
                    <th class="text-center">Stock Actual</th>
                    <th class="text-center">Stock Minimo</th>
                    <th class="text-center">Faltante</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for producto in productos.items %}
                <tr class="row-stock-bajo">
                    <td class="table-code">{{ producto.codigo }}</td>
                    <td>
                        <a href="{{ url_for('productos.detalle', id=producto.id) }}">
                            {{ producto.nombre }}
                        </a>
                    </td>
                    <td>{{ producto.categoria.nombre if producto.categoria else '-' }}</td>
                    <td class="text-center">
                        <span class="badge badge-danger">{{ producto.stock_actual|int }}</span>
                    </td>
                    <td class="text-center">{{ producto.stock_minimo|int }}</td>
                    <td class="text-center fw-bold text-danger">
                        {{ (producto.stock_minimo - producto.stock_actual)|int }}
                    </td>
                    <td>
                        <div class="action-icons">
                            <a href="{{ url_for('inventario.ajuste', producto_id=producto.id) }}"
                               class="action-icon"
                               title="Ajustar stock">
                                <span class="material-symbols-rounded">tune</span>
                            </a>
                            <a href="{{ url_for('inventario.movimientos_producto', producto_id=producto.id) }}"
                               class="action-icon"
                               title="Ver movimientos">
                                <span class="material-symbols-rounded">history</span>
                            </a>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <span class="material-symbols-rounded text-success">check_circle</span>
                            <p>Todos los productos tienen stock suficiente</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if productos.pages > 1 %}
{% include 'components/pagination.html' %}
{% endif %}
{% endblock %}
